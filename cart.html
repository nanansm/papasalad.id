<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Cart – PapaSalad</title>
  <!-- template css -->
  <link rel="stylesheet" href="assets/css/plugin.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
  <!-- shop layer -->
  <link rel="stylesheet" href="assets/css/shop.css">
</head>
<body data-cursor="true">

  <header>
        <nav>
            <!-- Logo -->
            <div class="logo hover-target">
                <a class="load-spiral" href="index.html"><img src="assets/img/logo.png" alt="logo" style="max-width: 200%; height: auto;"></a>
            </div>
            <div class="scr socials">
                <div class="list-social">
                    <ul>
                        <li class="hover-target"><a href="https://api.whatsapp.com/send?phone=6285117567544&text=Hallo%20Mote,%20Saya%20mau%20ngobrol%20tantang%20Aktivasi%20Digital%20Marketing." target="_blank">Contact Us.</a></li>
                        <li class="hover-target"><a href="cart.html" class="ps-badge">Keranjang <span id="cartCount" class="count">0</span></a></li>
                    </ul>
                </div>
            </div>

            <!-- Copyright -->
            <div class="scr copyright-top">
                <p>Mote &copy; 2025</p>
            </div>

            <div class="bg-nav"></div>
        </nav>
    </header>

  <main id="spiral">
    <section class="ps-shop">
      <div class="container">
        <div class="ps-head">
          <h2>Keranjang</h2>
          <p class="ps-note">Periksa pesanan Anda, isi data, lalu lanjut ke WhatsApp.</p>
        </div>

        <div id="cartBox" class="ps-cart"></div>

        <div class="ps-summary">
          <div class="row"><span>Subtotal</span><strong id="subtotal">Rp0</strong></div>
          <div class="row"><span>Total</span><strong id="total">Rp0</strong></div>
        </div>

        <div class="ps-head" style="margin-top:16px">
          <h3>Data Pemesan</h3>
        </div>
        <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;padding: 15px;">
          <div>
            <label class="ps-note">Nama</label>
            <input id="custName" placeholder="Nama Kamu">
          </div>
          <div>
            <label class="ps-note">No WhatsApp</label>
            <input id="custPhone" placeholder="08xxxxxxxxxx">
          </div>
          <div style="grid-column:1/-1">
            <label class="ps-note">Alamat/Catatan</label>
            <textarea id="notes" rows="3" placeholder="Alamat lengkap / catatan pesanan"></textarea>
          </div>
        </div>

        <button id="checkout" class="ps-btn" style="margin-top:16px">Checkout via WhatsApp</button>
        <p class="ps-note" style="margin-top:8px">Nomor WhatsApp & Google Sheet endpoint disetel di skrip halaman ini.</p>
      </div>
    </section>
  </main>

  <!-- template js -->
  <script src="assets/js/plugin.js"></script>
  <script src="assets/js/main.js"></script>

<script>
  /* ===== PapaSalad Cart Page ===== */
  const CART_KEY = 'papasalad_cart_v1';
  const WA_NUMBER = '6285117567544'; // GANTI ke nomor WA bisnis (tanpa +)

  // Helpers
  const shape = c => { c = c && typeof c==='object' ? c : {};
    c.items=c.items||{}; c.catalog=c.catalog||{}; return c; };
  const read = () => { try { return shape(JSON.parse(localStorage.getItem(CART_KEY)||'{}')); }
                       catch(_) { return shape({}); } };
  const write = c => localStorage.setItem(CART_KEY, JSON.stringify(shape(c)));
  const idr = n => 'Rp ' + (Number(n)||0).toLocaleString('id-ID');
  const countItems = () => Object.values(read().items).reduce((a,b)=>a+b,0);
  const updateBadge  = () => { const el=document.querySelector('#cartCount'); if(el) el.textContent=countItems(); };

  // Build UI
  function buildCartUI(){
    const root = document.querySelector('#cartBox');
    const subEl = document.querySelector('#subtotal');
    const totEl = document.querySelector('#total');
    const cart = read();

    root.innerHTML = '';
    let subtotal = 0;
    const ids = Object.keys(cart.items);

    if (!ids.length){
      root.innerHTML = '<div class="ps-note">Keranjang kosong. <a href="all-product.html">Belanja sekarang</a></div>';
      if (subEl) subEl.textContent = idr(0);
      if (totEl) totEl.textContent = idr(0);
      updateBadge();
      return;
    }

    ids.forEach(id=>{
      const qty  = cart.items[id];
      const meta = cart.catalog[id] || {name:id, price:0};
      const line = qty * (meta.price||0);
      subtotal += line;

      const row = document.createElement('div');
      row.className = 'ps-row';
      row.innerHTML = `
        <div>
          <strong>${meta.name}</strong>
          <div class="ps-note">${idr(meta.price)} × <span class="q">${qty}</span></div>
        </div>
        <div class="ps-qty">
          <button class="dec" data-id="${id}">−</button>
          <input class="qval" type="number" min="1" value="${qty}" data-id="${id}" style="width:60px;text-align:center">
          <button class="inc" data-id="${id}">+</button>
        </div>
        <div style="text-align:right">
          <div>${idr(line)}</div>
          <button class="ps-btn ghost rm" data-id="${id}" style="margin-top:6px">Hapus</button>
        </div>`;
      root.appendChild(row);
    });

    if (subEl) subEl.textContent = idr(subtotal);
    if (totEl) totEl.textContent = idr(subtotal); // belum menghitung ongkir/pajak
    updateBadge();
  }

  // Qty +/−, hapus, input manual
  document.addEventListener('click', (e)=>{
    const inc = e.target.closest('.inc')?.dataset.id;
    const dec = e.target.closest('.dec')?.dataset.id;
    const rm  = e.target.closest('.rm') ?.dataset.id;
    if(!inc && !dec && !rm) return;

    const cart = read();
    if (inc) cart.items[inc] = (cart.items[inc]||1) + 1;
    if (dec) cart.items[dec] = Math.max(1, (cart.items[dec]||1) - 1);
    if (rm)  delete cart.items[rm];

    write(cart);
    buildCartUI();
  });

  document.addEventListener('change', (e)=>{
    const inp = e.target.closest('.qval'); if(!inp) return;
    const id = inp.dataset.id; let v = parseInt(inp.value,10);
    if(!Number.isFinite(v) || v < 1) v = 1;
    const cart = read(); cart.items[id] = v; write(cart);
    buildCartUI();
  });

  // Checkout to WhatsApp
  function checkoutWA(){
    const cart = read();
    const ids = Object.keys(cart.items);
    if (!ids.length){ alert('Keranjang kosong'); return; }

    const name   = (document.querySelector('#custName') ?.value || '').trim() || '-';
    const phone  = (document.querySelector('#custPhone')?.value || '').trim() || '-';
    const notes  = (document.querySelector('#notes')    ?.value || '').trim() || '-';

    let rows = []; let sub = 0;
    ids.forEach(id=>{
      const q = cart.items[id];
      const m = cart.catalog[id] || {name:id, price:0};
      const line = q * (m.price||0); sub += line;
      rows.push(`• ${m.name} x${q} @ ${idr(m.price)} = ${idr(line)}`);
    });

    const text = `Halo PapaSalad! Saya mau pesan:%0A%0A${rows.join('%0A')}` +
                 `%0A%0ASubtotal: ${idr(sub)}` +
                 `%0ANama: ${encodeURIComponent(name)}` +
                 `%0AWhatsapp: ${encodeURIComponent(phone)}` +
                 `%0AAlamat/Catatan: ${encodeURIComponent(notes)}` +
                 `%0A%0ATerima kasih!`;

    const url = `https://wa.me/${WA_NUMBER}?text=${text}`;
    window.open(url, '_blank');
  }

  // Init
  document.addEventListener('DOMContentLoaded', ()=>{
    buildCartUI();
    updateBadge();
    const btn = document.querySelector('#checkout');
    if (btn) btn.addEventListener('click', checkoutWA);
  });
</script>

</body>
</html>